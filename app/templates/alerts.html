{% extends "base.html" %}

{% block title %}预警信息 - 服务器监控系统{% endblock %}

{% block content %}
<!-- 页面标题 -->
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="h3 mb-0">预警信息</h1>
            <button class="btn btn-outline-primary" id="refreshAlerts">
                <i class="bi bi-arrow-clockwise me-1"></i>刷新数据
            </button>
        </div>
        <hr class="my-3">
    </div>
</div>

<!-- 预警列表 -->
<div class="row">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="card-title mb-0">
                    <i class="bi bi-bell me-2 text-primary"></i>最新预警
                </h5>
            </div>
            <div class="card-body">
                {% if alerts %}
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>服务器IP</th>
                                <th>预警类型</th>
                                <th>预警信息</th>
                                <th>时间</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for alert in alerts %}
                            <tr>
                                <td>
                                    <span class="badge bg-primary-subtle text-primary">{{ alert.ip_address }}</span>
                                </td>
                                <td>
                                    {% if alert.alert_type == 'cpu' %}
                                        <span class="badge bg-danger-subtle text-danger">
                                            <i class="bi bi-cpu me-1"></i>CPU
                                        </span>
                                    {% elif alert.alert_type == 'memory' %}
                                        <span class="badge bg-warning-subtle text-warning">
                                            <i class="bi bi-memory me-1"></i>内存
                                        </span>
                                    {% elif alert.alert_type == 'disk' %}
                                        <span class="badge bg-info-subtle text-info">
                                            <i class="bi bi-hdd me-1"></i>磁盘
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary-subtle text-secondary">
                                            <i class="bi bi-question-circle me-1"></i>{{ alert.alert_type }}
                                        </span>
                                    {% endif %}
                                </td>
                                <td>{{ alert.alert_message }}</td>
                                <td>{{ alert.timestamp.strftime('%Y-%m-%d %H:%M:%S') if alert.timestamp else '未知' }}</td>
                                <td>
                                    {% if alert.is_sent %}
                                        <span class="badge bg-success-subtle text-success">
                                            <i class="bi bi-check-circle me-1"></i>已发送
                                        </span>
                                    {% else %}
                                        <span class="badge bg-warning-subtle text-warning">
                                            <i class="bi bi-clock me-1"></i>待发送
                                        </span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-bell-slash text-muted fs-1 mb-3"></i>
                    <h6 class="text-muted">暂无预警信息</h6>
                    <p class="text-muted small">系统会自动监控服务器状态并在异常时生成预警</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 刷新按钮事件
    document.getElementById('refreshAlerts').addEventListener('click', function() {
        location.reload();
    });
});
</script>
{% endblock %}