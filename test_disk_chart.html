<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>磁盘趋势图表测试</title>
    <!-- Plotly JS from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist-min@2.24.1/plotly.min.js"></script>
    <style>
        .chart-container {
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: none;
            margin: 2rem;
            background: white;
            padding: 1.5rem;
        }
    </style>
</head>
<body>
    <h1>磁盘趋势图表测试</h1>
    
    <div class="chart-container">
        <h2>磁盘使用趋势</h2>
        <div id="disk-chart" style="height: 400px;"></div>
    </div>

    <script>
        // 模拟API返回的数据
        const mockData = {
            "history": {
                "C:\\": [
                    {"percent": 79.23, "timestamp": "2025-11-23T11:27:19.579219"},
                    {"percent": 79.30, "timestamp": "2025-11-23T11:28:19.579219"},
                    {"percent": 79.40, "timestamp": "2025-11-23T11:29:19.579219"},
                    {"percent": 79.45, "timestamp": "2025-11-23T11:30:19.579219"},
                    {"percent": 79.50, "timestamp": "2025-11-23T12:25:30.220125"}
                ],
                "D:\\": [
                    {"percent": 31.5, "timestamp": "2025-11-23T11:27:19.579219"},
                    {"percent": 31.5, "timestamp": "2025-11-23T11:28:19.579219"},
                    {"percent": 31.4, "timestamp": "2025-11-23T11:29:19.579219"},
                    {"percent": 31.4, "timestamp": "2025-11-23T11:30:19.579219"},
                    {"percent": 31.3, "timestamp": "2025-11-23T12:25:30.220125"}
                ],
                "E:\\": [
                    {"percent": 62.07, "timestamp": "2025-11-23T11:27:19.579219"},
                    {"percent": 62.07, "timestamp": "2025-11-23T11:28:19.579219"},
                    {"percent": 62.07, "timestamp": "2025-11-23T11:29:19.579219"},
                    {"percent": 62.07, "timestamp": "2025-11-23T11:30:19.579219"},
                    {"percent": 62.07, "timestamp": "2025-11-23T12:25:30.220125"}
                ]
            }
        };

        /**
         * 绘制磁盘使用趋势图表
         */
        function drawDiskChart(historyData) {
            if (!historyData || Object.keys(historyData).length === 0) return;
            
            // 创建图表数据
            const chartData = [];
            
            // 为每个磁盘设备创建一条线
            for (const device in historyData) {
                const deviceData = historyData[device];
                const timestamps = deviceData.map(item => new Date(item.timestamp));
                const percents = deviceData.map(item => item.percent);
                
                chartData.push({
                    x: timestamps,
                    y: percents,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: device,
                    line: {shape: 'spline', color: '#4cc9f0'},
                    marker: {size: 6}
                });
            }
            
            // 图表布局
            const layout = {
                title: '磁盘使用趋势',
                xaxis: {title: '时间'},
                yaxis: {title: '使用率(%)', range: [0, 100]},
                margin: {t: 30, l: 50, r: 30, b: 50}
            };
            
            // 绘制图表
            const chartElement = document.getElementById('disk-chart');
            if (chartElement) {
                // 确保Plotly已经加载
                if (typeof Plotly !== 'undefined') {
                    Plotly.newPlot('disk-chart', chartData, layout);
                }
            }
        }

        // 页面加载完成后绘制图表
        document.addEventListener('DOMContentLoaded', () => {
            drawDiskChart(mockData.history);
        });
    </script>
</body>
</html>